import csv
import collections
import sys
import math
import string
from pandas import *
import numpy as np
from fmap import fmap
from datetime import datetime

string_party_map = {
    "Republican" : 0,
    "Democrat" : 1,
    "Libertarian" : 2
}

date_map = {
    "Republican": [0]*53,
    "Democrat": [0]*53,
    "Libertarian": [0]*53
}

formatted_date_map = {
    "Republican": [0]*53,
    "Democrat": [0]*53,
    "Libertarian": [0]*53
}

jan1 = datetime(2011, 1, 1)

def add_party_column(df):
    party_map = {'P20002556': 0, 'P20003109': 0, 'P20002978': 0, 'P20002671': 2, 'P60003654': 0, 'P20002721': 0, 'P20003067': 0, 'P80003353': 0, 'P00003608': 0, 'P20003281': 0, 'P80000748': 0, 'P20002523': 0, 'P80003338': 1}
    party_names = { 0: "Republican", 1: "Democrat", 2: "Libertarian" }
    df.insert(len(df.columns), "party", '')
    
    # cache the id column
    candidate_ids = df['cand_id']

    for i in xrange(len(df)):
        df['party'][i] = party_names[party_map[candidate_ids[i]]]

df = read_csv('P00000001-ALL.txt')
add_party_column(df)

for i,party in enumerate(df['party']):
    date_index = (datetime.strptime(df['contb_receipt_dt'][i], "%d-%b-%y") - jan1). \
        days + 1
    date_map[party][int(date_index/7)] += df['contb_receipt_amt'][i]

for pid, party in enumerate(date_map):
    for i,value in enumerate(date_map[party]):
        formatted_date_map[party][i] = { "x": i, "y": value, "p": string_party_map[party] }

print formatted_date_map
